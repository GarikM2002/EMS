@page "/register"
@inject AuthService AuthService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<MudPaper Width="400px" Class="pa-4 mx-auto mt-12">
    <MudText Typo="Typo.h4" Class="mb-4">Register</MudText>
    <MudForm @ref="form" @OnValidSubmit="HandleRegister">
        <MudTextField @bind-Value="registerRequest.FirstName" Label="First Name" Required="true" />
        <MudTextField @bind-Value="registerRequest.LastName" Label="Last Name" Required="true" />
        <MudTextField @bind-Value="registerRequest.Email" Label="Email" Required="true" Type="email" />
        <MudTextField @bind-Value="registerRequest.Password" Label="Password" Required="true" Type="password" />
        <MudButton Color="Color.Primary" Variant="Variant.Filled" Type="submit">Register</MudButton>
    </MudForm>
    @if (errorMessage != null)
    {
        <MudText Color="Color.Error" Class="mt-2">@errorMessage</MudText>
    }
</MudPaper>

@code {
    private MudForm form = null!;
    private RegistrationViewModel registerRequest = new();
    private string errorMessage = null!;

    private async Task HandleRegister()
    {
        var response = await AuthService.RegisterAsync(registerRequest);
        if (response.IsSuccessStatusCode)
        {
            Navigation.NavigateTo("/login");
        }
        else
        {
            errorMessage = "Registration failed";
        }
    }
}
